<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assignment 4 – Lead Time & Bullwhip Effect Analysis</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f8f9fa; padding:20px; }
    h1 { color: #007bff; margin-bottom:20px; }
    .card { margin-bottom:15px; }
    .chart-container { margin-top:30px; }
    canvas { background:white; border:1px solid #ddd; padding:10px; }
  </style>
</head>
<body>
  <h1>Assignment 4 – Lead Time & Bullwhip Effect Analysis</h1>
  <input type="file" id="csvFile" accept=".csv" class="form-control mb-4" />

  <div id="summary"></div>

  <div class="chart-container">
    <canvas id="delayChart" width="600" height="300"></canvas>
    <canvas id="demandChart" width="600" height="300"></canvas>
    <canvas id="correlationChart" width="600" height="300"></canvas>
  </div>

<script>
document.getElementById('csvFile').addEventListener('change', e => {
  Papa.parse(e.target.files[0], {
    header: true,
    skipEmptyLines: true,
    dynamicTyping: true,
    complete: r => analyze(r.data)
  });
});

function analyze(data) {
  const agg = {
    supplier:{}, transport:{}, monthDelay:{},
    disruption:{}, product:{}, monthDemand:{}, monthOrder:{}
  };

  data.forEach(r=>{
    const od=new Date(r.Order_Date), ad=new Date(r.Actual_Delivery_Date),
          ed=new Date(r.Expected_Delivery_Date);
    const lead=(ad-od)/86400000, delay=(ad-ed)/86400000;
    const m=ad.getMonth()+1;

    const add=(o,k,v)=>{ if(!o[k]) o[k]=[]; o[k].push(v); };
    add(agg.supplier, r.Supplier, lead);
    add(agg.transport, r.Transportation_Mode, lead);
    add(agg.monthDelay, m, delay);
    if(r.Disruption_Type!=='None') add(agg.disruption, r.Disruption_Type, delay);
    add(agg.product, r.Product_Category, lead);
    add(agg.monthDemand, m, r.Customer_Demand);
    add(agg.monthOrder, m, r.Order_Quantity);
  });

  const avg=arr=>arr.reduce((a,b)=>a+b,0)/arr.length;
  const summarize=obj=>Object.entries(obj).map(r=>[r[0], avg(r[1])]);
  const top=(arr,fn)=>arr.sort(fn)[0][0];

  const supArr=summarize(agg.supplier), transArr=summarize(agg.transport),
        monthArr=summarize(agg.monthDelay), disArr=summarize(agg.disruption),
        prodArr=summarize(agg.product);
  const demArr=summarize(agg.monthDemand), ordArr=summarize(agg.monthOrder);

  const summaryHTML=`
  <div class="card p-3">
    <h5>Simple Questions ✅</h5>
    <ul>
      <li><strong>Highest Avg Lead Time Supplier:</strong> ${top(supArr,(a,b)=>b[1]-a[1])}</li>
      <li><strong>Fastest Transport Mode:</strong> ${top(transArr,(a,b)=>a[1]-b[1])}</li>
      <li><strong>Month w/ Highest Delay:</strong> ${top(monthArr,(a,b)=>b[1]-a[1])}</li>
      <li><strong>Worst Disruption Type:</strong> ${top(disArr,(a,b)=>b[1]-a[1])}</li>
      <li><strong>Shortest Avg Lead Time Product:</strong> ${top(prodArr,(a,b)=>a[1]-b[1])}</li>
    </ul>
  </div>`;
  document.getElementById('summary').innerHTML=summaryHTML;

  const months=monthArr.map(r=>r[0]).sort((a,b)=>a-b);
  const delays=months.map(m=>avg(agg.monthDelay[m])),
        demands=months.map(m=>avg(agg.monthDemand[m])),
        orders=months.map(m=>avg(agg.monthOrder[m]));

  new Chart(document.getElementById('delayChart'), {
    type:'line',
    data:{labels:months,datasets:[{label:'Avg Delay (days)',data:delays,borderColor:'red',tension:0.3}]},
    options:{plugins:{title:{display:true,text:'Monthly Lead Time Seasonality'}}}
  });

  new Chart(document.getElementById('demandChart'), {
    type:'bar',
    data:{labels:months,datasets:[
      {label:'Customer Demand',data:demands,backgroundColor:'blue'},
      {label:'Order Quantity',data:orders,backgroundColor:'orange'}
    ]},
    options:{plugins:{title:{display:true,text:'Bullwhip Effect – Demand vs Orders'}}}
  });

  const orderVars=months.map(m=>Math.log(agg.monthOrder[m].reduce((a,b)=>a+(b-avg(agg.monthOrder[m]))**2,0)/(agg.monthOrder[m].length-1)));
  const delayVars=months.map(m=>Math.log(agg.monthDelay[m].reduce((a,b)=>a+(b-avg(agg.monthDelay[m]))**2,0)/(agg.monthDelay[m].length-1)));

  new Chart(document.getElementById('correlationChart'), {
    type:'scatter',
    data:{datasets:[{label:'Variability Correlation (log)','data':months.map((m,i)=>({x:orderVars[i],y:delayVars[i]})),pointBackgroundColor:'green'}]},
    options:{plugins:{title:{display:true,text:'Lead Time Variability vs Order Variability'}},scales:{x:{title:{display:true,text:'Log Var Order Qty'}},y:{title:{display:true,text:'Log Var Delay'}}}}
  });
}
</script>
</body>
</html>






